<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="us.duia.leejo0531.dao.ReplyMapper">
	<!-- 답변을 게시한다. -->
	<insert id="insertReply" parameterType="Reply">
	
	<!-- code here -->
	
	</insert>
	
	<!-- 답변을 삭제한다. (임시) 테스트 되지않음.-->
	<delete id="deleteReply" parameterType="Reply">
		delete Q_Reply where usernum = #{UserNum} and ReplyNum = #{ReplyNum}
	<!-- code here -->
	
	</delete>
	
	<select id="searchReplyTitleByContext" parameterType="java.util.ArrayList" resultMap="Reply">
	    select
            *
        from
            q_reply
        <trim prefix="where" prefixOverrides="and|or">
        	<foreach collection="list" item="item">and replytitle like '%${item}%'</foreach>
        </trim>
	</select>
	
	<!-- context가 포함된 모든 답변을 가져온다. -->
	<select id="searchByContext" parameterType="java.util.ArrayList" resultType="Reply">
		select
	        *
	    from
	        q_reply
	    <trim prefix="where" prefixOverrides="and|or">
	    	<foreach collection="list" item="item">and contains(replycontent, '%${item}%') >0</foreach>
	    </trim>
	</select>
	
	<!-- 답변을 1개(?)가져온다. -->
	<insert id="selectOneReply" parameterType="Reply">
	<!-- code here -->
	</insert>
	
	<insert id="insertReplyTest" parameterType="Reply">
		insert into q_reply values (q_reply_seq.nextval, #{questionNum}, #{userNum}, sysdate, sysdate, #{ReplyTitle}, #{ReplyContent})
	</insert>
	
	<select id="questionReplyList" parameterType="int" resultType="Reply">
		select reply.REPLYNUM, 
		reply.QUESTIONNUM, 
		reply.USERNUM, 
		to_char(reply.R_REGDATE, 'YYYY-MM-DD') as R_REGDATE, 
		to_char(reply.R_MODDATE, 'YYYY-MM-DD') as R_MODDATE, 
		reply.REPLYTITLE, 
		reply.REPLYCONTENT, 
		userinfo.id from q_reply reply, userinfo userinfo 
		where reply.questionnum = 80 and reply.usernum = userinfo.usernum order by replyNum 
	</select>
</mapper>
